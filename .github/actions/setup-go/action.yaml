name: setup golang
description: 'Golangのセットアップ'

inputs:
  working-directory:
    description: '作業ディレクトリ'
    required: false
    default: '.'

runs:
  using: composite
  steps:
  - name: Setup Golang
    uses: actions/setup-go@4dc6199c7b1a012772edbd06daecab0f50c9053c # v6.1.0
    with:
      go-version-file: ${{ inputs.working-directory }}/go.mod
      cache: false

  - name: Cache Modules
    uses: actions/cache@0057852bfaa89a56745cba8c7296529d2fc39830 # v4.3.0
    with:
      path: |
        ~/go/pkg/mod
      key: ${{ runner.os }}-go-${{ hashFiles(format('{0}/go.mod', inputs.working-directory), format('{0}/go.sum', inputs.working-directory)) }}
      restore-keys: |
        ${{ runner.os }}-go-${{ hashFiles(format('{0}/go.mod', inputs.working-directory), format('{0}/go.sum', inputs.working-directory)) }}
        ${{ runner.os }}-go-

  - name: Download modules
    shell: bash
    working-directory: ${{ inputs.working-directory }}
    run: go mod download

  - name: Install tools
    shell: bash
    working-directory: ${{ inputs.working-directory }}
    run: go get tool

  - name: Generate
    shell: bash
    working-directory: ${{ inputs.working-directory }}
    run: go generate ./...
