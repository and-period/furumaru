# ADR-002: モジュラモノリスアーキテクチャの継続

## ステータス

承認済み

## 日付

2026-02-21

## コンテキスト

Furumaru は現在、モジュラモノリス + レイヤードアーキテクチャ (5層構造) を採用している。

```
Gateway (Gin HTTP)
  └─ Service Interface
       └─ Service Implementation
            └─ Database (TiDB/GORM)
                 └─ Entity
```

4つのドメインモジュール (User, Store, Media, Messenger) が単一アプリケーション内で動作し、モジュール間は Go の関数呼び出しで連携している。各モジュールは独立した DB (TiDB) を持つ。

リファクタリングの計画に際して、アーキテクチャの根本的な変更 (マイクロサービス分割等) を検討する必要があるか判断が必要となった。

### 2026年の業界動向

2026年時点での業界調査により、以下の傾向が確認された。

- **42% の組織がマイクロサービスからモジュラモノリスへの統合 (回帰) を行っている**
- マイクロサービスの総コストはモノリスの 3.75〜6倍
- 推奨パターン: モジュラモノリスをコアに据え、ホットパスのみ 2〜5 サービスを分離

## 決定

**現行のモジュラモノリスアーキテクチャを継続する。** マイクロサービスへの分割は行わない。

### 根拠

1. **業界トレンドとの合致**: 2026年のトレンドは「マイクロサービスからモジュラモノリスへの回帰」であり、現行アーキテクチャはこの方向性と一致している

2. **運用コストの優位性**: マイクロサービス化によるインフラ・運用コストの増加 (3.75〜6倍) は、現在のプロジェクト規模では正当化できない

3. **現行構成の成熟度**: 4モジュール・424+メソッドの規模はモジュラモノリスで十分に管理可能であり、モジュール間の境界は明確に維持されている

4. **開発チームの規模**: 少人数チームでのマイクロサービス運用は、デプロイ・監視・障害対応の負荷が過大となる

5. **データベース分離の達成**: 各モジュールが独立した DB を持つため、将来的な分離の前提条件は既に満たしている

## 検討した選択肢

### 選択肢1: モジュラモノリス継続 (採用)
- 利点: 運用コスト低、開発速度維持、分散トランザクション不要、デバッグ容易
- 欠点: 個別スケーリング不可、デプロイ単位が全体
- **採用**: 現在の規模と要件に最適

### 選択肢2: 完全マイクロサービス化
- 利点: 個別スケーリング、独立デプロイ、技術選択の自由度
- 欠点: 運用コスト 3.75〜6倍、分散トランザクションの複雑性、チーム規模に不適
- **却下**: コストが利点を大幅に上回る

### 選択肢3: ハイブリッド (ホットパス分離)
- 利点: ホットパスのスケーラビリティ確保
- 欠点: 分離判断の複雑性、中途半端な状態のリスク
- **保留**: 現時点で明確なホットパスが存在しない。トラフィック増加時に再検討

## 結果

### 期待される効果
- 運用コストの維持 (マイクロサービス化によるコスト増回避)
- 開発速度の維持 (分散システム特有の複雑性回避)
- リファクタリングのスコープを構成改善に集中可能

### 受け入れるトレードオフ
- モジュール単位の個別スケーリングは不可
- デプロイは全体が単位となる (ただし Go のバイナリサイズは軽量)
- 将来的にトラフィック急増した場合、ホットパス分離の判断が必要となる

### 再評価の条件
以下の条件のいずれかを満たした場合、本決定を再評価する。
- 月間リクエスト数が現行の10倍を超えた場合
- 開発チームが10名以上に拡大した場合
- 特定モジュールのスケーリング要件が他モジュールと著しく異なる場合

## 関連

- [全体設計書](../overview.md)
- [既存設計決定: なぜマイクロサービスアーキテクチャを採用したか](../../design-decisions.md)
- [システム全体概要](../../overview.md)
