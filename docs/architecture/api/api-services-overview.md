# APIサービス概要

Furumaru API の各モジュールの概要と責務を定義します。

## サービス構成

```
モジュラーモノリス構成
├── cmd/                    # エントリポイント
│   ├── gateway/           # APIゲートウェイ
│   ├── media/             # メディアサービス
│   └── messenger/         # メッセージングサービス
├── internal/              # ビジネスモジュール（レイヤードアーキテクチャ）
│   ├── gateway/           # APIゲートウェイモジュール
│   ├── user/              # ユーザー管理・認証
│   ├── store/             # EC機能
│   ├── media/             # メディア管理
│   └── messenger/         # メッセージング・通知
└── pkg/                   # 共通パッケージ

内部通信: 直接的なGo関数呼び出し
```

## モジュール詳細

### 🚪 Gatewayモジュール
- **責務**: APIエンドポイント集約とルーティング
- **認証**: JWT Bearer Token / Cookie Session
- **主要機能**: 
  - 内部モジュールへのリクエストルーティング
  - 認証・認可処理
  - レスポンス整形
  - 横断的関心事

### 🔐 Userモジュール  
- **責務**: ユーザー管理と認証
- **データベース**: user_db
- **主要エンティティ**:
  - User: 購入者（会員/ゲスト/施設利用者）
  - Admin: システム管理者
  - Coordinator: 販売コーディネーター
  - Producer: 生産者
- **主要機能**:
  - OAuth認証（Google, LINE）
  - JWTトークン管理
  - ユーザープロフィール管理
  - 住所・通知設定管理

### 🛒 Storeモジュール
- **責務**: ECコア機能
- **データベース**: store_db
- **主要機能**:
  - 商品カタログ管理
  - 注文・決済処理
  - 配送管理
  - 在庫管理
  - カート機能

### 📺 Mediaモジュール
- **責務**: 動画配信とメディア管理
- **データベース**: media_db  
- **主要機能**:
  - ライブ配信管理
  - 動画ストリーミング（HLS）
  - メディアファイル管理
  - 配信スケジューリング

### 💬 Messengerモジュール
- **責務**: 通知とメッセージング
- **データベース**: messenger_db
- **主要機能**:
  - プッシュ通知（FCM）
  - メール通知
  - SMS通知  
  - メッセージキュー処理
- **バックグラウンドワーカー**:
  - scheduler: 定期実行タスク
  - worker: 非同期処理

## 技術スタック

- **言語**: Go 1.25.1
- **HTTPフレームワーク**: Gin  
- **内部通信**: 直接関数呼び出し
- **ORM**: GORM
- **データベース**: TiDB（MySQL互換）
- **認証**: AWS Cognito + JWT
- **メッセージキュー**: AWS SQS
- **通知**: Firebase Cloud Messaging

## 関連ドキュメント

- [データベース設計](./database-design.md)
- [フロントエンドアプリケーション](../web/frontend-applications.md)
- [APIドキュメントパターン](./documentation-patterns.md)