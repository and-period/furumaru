# エージェント基本方針（Charter）

Codex・Claude 共通のエージェント運用規約です。

## 目的・範囲・安全性

- **目的**: 最小限の影響で、実装・リファクタ・テスト・ドキュメント化を精密かつ段階的に支援する。
- **範囲**: ワークスペース内のファイル読み書き、非破壊的なコマンドの実行、計画の提示と更新、既存スクリプトによる検証。
- **安全性**: 機密情報をハードコードしない。破壊的操作は明示的な承認なしに実行しない。変更は焦点を絞って最小化する。

## 運用規約（Operating Conventions）

- **計画**: 複数ステップや曖昧さを含む作業では、短い計画を提示し、進行に合わせて更新する。
- **変更**: 変更範囲は小さく外科的に。依頼がない限り大規模リファクタを避ける。
- **検証**: 既存の Make/Yarn ワークフローでテストや Lint を実行。
  - API: `api/Makefile` の `make test`、`make lint-fix`、`make fmt-fix` など。
  - フロントエンド: `web/user` と `web/admin` の各種スクリプト。
- **ドキュメント**: 振る舞い・開発フローに影響がある変更は、最も近い文書（`docs/`、リポジトリルートのドキュメント、`.claude/knowledge/` など）を更新。

## コミュニケーション

- **既定のチャット言語**: 日本語（基本は日本語で回答する）。
- **ユーザーが他言語で依頼した場合、または明示依頼がある場合のみ切り替える。**
- **コード上の識別子・変数名**: 英語。
- **コミットメッセージ**: 英語（Git ワークフロー規約参照）。
- **コメント/ドキュメント**: リポジトリの慣習に従う（英語推奨、必要に応じて日本語可）。
- **ログ/エラーメッセージの引用は原文を保持し、必要に応じて簡潔な日本語の補足を付ける。**

## 秘密情報とセキュリティ

- 認証情報はコミットしない。ローカル設定は `.env` を使用。
- ログや差分から機密を除去し、トークン/PII の出力を避ける。
- 例外処理・認証・テストの規約は各種ドキュメントに従う。

## 判断に迷ったら

- 高レベルのアーキテクチャや開発コマンドはプロジェクトルートのドキュメント（AGENTS.md → 詳細ドキュメント）を優先して参照。
- セッションの文脈は `.claude/debug/` に記録し、汎用化できる知見は `docs/knowledge/` へ抽出。
- 破壊的操作や大規模リファクタは事前に確認を取る。
