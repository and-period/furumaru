# 設計原則

## 基本原則

### 1. マイクロサービスアーキテクチャの原則
- 各サービスは単一の責務を持つこと
- サービス間の依存は最小限に保つこと
- データベースはサービスごとに分離すること

### 2. レイヤードアーキテクチャの原則
各サービス内部は以下の層で構成すること：
- **API層**: 外部インターフェース責務
- **サービス層**: ビジネスロジック責務
- **データベース層**: データアクセス責務
- **エンティティ層**: ドメインモデル責務

### 3. 通信方式の原則
- 外部通信はREST APIを使用すること
- 内部モジュール間は関数呼び出しを使用すること
- 非同期処理はメッセージキューを使用すること

## サービス設計原則

### 1. ゲートウェイの責務原則
ゲートウェイは以下の責務のみを持つこと：
- 認証・認可の処理
- リクエストの検証
- 複数サービスの集約
- レスポンスの整形

### 2. 内部サービスの責務原則
内部サービスは以下の責務を持つこと：
- ビジネスロジックの実装
- データの永続化
- ドメインルールの適用
- イベントの発行

### 3. エラーハンドリング原則
- 各層で適切なエラーハンドリングを実装すること
- エラーは構造化して上位層に伝播すること
- クライアントには適切なHTTPステータスコードを返すこと

## データ設計原則

### 1. データベース分離原則
- サービスごとに独立したデータベースを持つこと
- 他サービスのデータベースに直接アクセスしないこと
- 必要な場合はAPIを通じてデータを取得すること

### 2. トランザクション原則
- トランザクションはサービス内で完結させること
- 分散トランザクションは避けること
- 最終的整合性を許容する設計にすること

### 3. イベント駆動原則
- 状態変更時は適切なイベントを発行すること
- イベントは冪等性を持つように設計すること
- リトライ処理を考慮した実装をすること

## セキュリティ原則

### 1. 認証・認可原則
- 認証は統一された認証基盤を使用すること
- 認可はゲートウェイレベルで実施すること
- 内部サービス間は信頼された通信とすること

### 2. データ保護原則
- 個人情報は適切に暗号化すること
- ログに機密情報を出力しないこと
- 環境変数で機密情報を管理すること